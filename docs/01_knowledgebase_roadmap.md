# MoniBox 知识库构建路线图（终局框架与精进方向）

本文描述：当前我们在“调试与冷启动”阶段，但最终知识库会精进到什么程度、有哪些核心模块、如何形成闭环迭代。

---

## 0. 核心目标（灾害场景的“离线、可控、可执行”知识系统）

MoniBox 的知识库不是“百科问答”，而是面向地震受困人群的：
1) **安全优先**：不做诊断、不提供危险处置、可降级
2) **低延迟**：TTS 秒级响应，优先短句与可执行指令
3) **强可控**：高风险场景走协议/规则，不把生死交给 LLM 幻觉
4) **可追溯与可迭代**：每条回答可追踪来源、可调权、可替换、可禁用
5) **多模态融合**：传感器事件（余震/跌落/紧握）能直接触发“行为协议”

---

## 1. 知识资产分层（从“文本”进化到“可执行系统”）

### 1.1 L0：原始资料层（Raw Sources）
来源类型：
- 文档/指南/论文（中英文）
- CSV/开源数据集/JSON 数据
- 专家审核稿（心理、急救、救援专业）
- 合成数据（LLM 生成，用于冷启动）

最终要求：
- 每条知识必须绑定 `source_id`
- 具备版本号与可审计信息（何时引入、谁审核、可信等级）

---

### 1.2 L1：标准化片段层（Atomic Chunks for RAG）
核心单位：**60 字左右、可直接 TTS 的知识片段 chunk**

每条 chunk 的最终字段至少包含：
- 片段ID、文本、维度、标签、适用人群、风险等级
- 来源ID、状态（候选/启用/停用）、指纹（去重）、人工评分（迭代）

目标：
- 支持“SQL 过滤 + 向量检索”
- 支持“权威来源优先、合成数据降权”
- 支持“测试后把差片段停用、好片段提权”

---

### 1.3 L2：可执行协议层（Protocols > LLM）
在高风险/高时效场景：不依赖 LLM，自上而下执行协议，例如：
- 余震触发 → 护头提醒 + 灯效 + 追问可移动性
- 恐慌触发 → 呼吸节奏引导 + 地面锚定
- 儿童模式 → 具象故事 + 数数游戏化干预

协议由数据驱动，最终结构包含：
- 触发条件（传感器事件/关键词/意图）
- 动作（TTS/灯带/屏幕/提示音）
- 安全约束（禁止建议列表）
- 后续追问（槽位收集）

目标：
- 在 Radxa 上实现 **低延迟、强可控** 的“救援行为引擎”
- LLM 只作为“非紧急、解释性、安抚性”补充

---

### 1.4 L3：知识图谱与因果约束层（KG + Constraints）
你已有的变量矩阵与因果门会进入这一层：
- 实体（症状/风险/环境/人群/干预动作）
- 关系（导致、伴随、禁忌、优先）
- 约束（恐慌-心率一致性；低温+失血→失温加速等）

目标：
- 支撑更可靠的推理与校验（减少幻觉）
- 支撑场景生成与对抗测试（自动生成高覆盖测试集）

---

## 2. 数据质量闭环（“可追溯 → 可测试 → 可调权 → 可替换”）

### 2.1 来源分级（Source Registry）
每个来源定义：
- 权威等级（expert/guideline > community > synthetic）
- 基础优先级
- 是否允许进入“医疗高风险启用态”

合成数据默认：
- 权威低、优先级低、状态候选、必须人工审核后启用

---

### 2.2 去重与替换（Dedup & Replace）
两级去重：
1) 指纹去重（文本相同直接合并/跳过）
2) 语义近似去重（embedding 相似度过高）
替换策略：
- 权威更高者替换旧者（旧标停用但保留审计）

---

### 2.3 测试与评分（Evaluation）
每次对话输出记录：
- 命中片段ID、来源ID、相似度、最终排序因子
测试人员可给：
- 片段评分（0~5）
- 标记“危险/无效/重复/很好”
系统据此：
- 动态提权或停用
- 形成“优质回答优先命中但不重复”的稳定体验

---

## 3. 最终到达的成熟形态（终局图景）
当体系成熟后，你会拥有：

1) 端侧 rag.db（sqlite-vec）+ runtime_pack（协议/事件/词表）
2) 可追溯来源、多版本替换、可审计的知识资产管理
3) 在“余震/恐慌/儿童/缺氧疑似”等关键场景：
   - 优先协议执行（不依赖 LLM）
4) 在一般安抚对话：
   - RAG 检索 + 小模型生成（Qwen0.5B）
5) 对抗测试/场景生成：
   - 从变量矩阵采样，自动生成高覆盖测试集与改进建议

这才是 MoniBox 的“离线多模态情感计算与边缘 LLM 融合”的最终形态。